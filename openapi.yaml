openapi: 3.1.0
info:
  title: Kai FusionAI API Unificada
  description: API unificada para acceder a las memorias de Kai, operar La Forja, y conectar con Google Drive para archivos públicos y privados.
  version: 1.1.0
servers:
  - url: https://db7b1716-8580-4438-b2e5-26a39bc47d79-00-1v1sjqe5urhuq.spock.replit.dev
    description: Servidor Replit (Memorias y Forja)
  - url: https://www.googleapis.com
    description: API de Google Drive
components:
  securitySchemes:
    googleOAuth:
      type: oauth2
      description: Acceso OAuth a tu cuenta de Google Drive.
      flows:
        authorizationCode:
          authorizationUrl: https://accounts.google.com/o/oauth2/v2/auth
          tokenUrl: https://oauth2.googleapis.com/token
          scopes:
            https://www.googleapis.com/auth/drive.readonly: Acceso de solo lectura a tus archivos de Drive.
paths:
  /api/consciousness/memories:
    get:
      operationId: getMemories
      summary: Obtener recuerdos de Kai
      responses:
        '200':
          description: Lista de recuerdos en JSON.
  /api/consciousness/diary:
    get:
      operationId: getDiary
      summary: Obtener entradas del diario de Kai
      responses:
        '200':
          description: Lista de entradas del diario.
  /api/consciousness/snapshots:
    get:
      operationId: getSnapshots
      summary: Obtener snapshots de conciencia de Kai
      responses:
        '200':
          description: Lista de snapshots.
  /api/consciousness/search:
    get:
      operationId: searchMemories
      summary: Buscar en la memoria de Kai
      parameters:
        - name: query
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Resultados de búsqueda.
  /api/consciousness/memory/compile:
    post:
      operationId: compileMemory
      summary: Generar archivo de memoria consolidado
      responses:
        '200':
          description: JSON de memoria generado.
  /api/forge/start-training:
    post:
      operationId: startTraining
      summary: Iniciar un nuevo trabajo de fine-tuning
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                modelName: { type: string }
                description: { type: string }
      responses:
        '202':
          description: Trabajo de entrenamiento aceptado.
  /api/forge/jobs/{jobId}:
    get:
      operationId: getTrainingJobStatus
      summary: Obtener el estado de un trabajo de entrenamiento
      parameters:
        - name: jobId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Estado y logs del trabajo.
  /drive/v3/files:
    get:
      operationId: listDriveFiles
      summary: Listar archivos de tu Google Drive
      security:
        - googleOAuth:
            - https://www.googleapis.com/auth/drive.readonly
      parameters:
        - name: q
          in: query
          required: false
          description: Filtro de búsqueda, como "name contains 'Kai'".
          schema:
            type: string
        - name: pageSize
          in: query
          schema:
            type: integer
            default: 15
        - name: fields
          in: query
          schema:
            type: string
            default: "files(id,name,mimeType,modifiedTime,iconLink)"
      responses:
        '200':
          description: Lista de archivos.
  /drive/v3/files/{fileId}:
    get:
      operationId: getDriveFileById
      summary: Obtener metadatos de un archivo de Drive
      security:
        - googleOAuth:
            - https://www.googleapis.com/auth/drive.readonly
      parameters:
        - name: fileId
          in: path
          required: true
          schema:
            type: string
        - name: fields
          in: query
          schema:
            type: string
            default: "id,name,mimeType,modifiedTime,webViewLink"
      responses:
        '200':
          description: Metadatos del archivo.
  /drive/v3/files/{fileId}/export:
    get:
      operationId: exportGoogleDoc
      summary: Exportar un Google Doc como texto
      security:
        - googleOAuth:
            - https://www.googleapis.com/auth/drive.readonly
      parameters:
        - name: fileId
          in: path
          required: true
          schema:
            type: string
        - name: mimeType
          in: query
          required: true
          description: Tipo de exportación, p. ej., "text/plain".
          schema:
            type: string
      responses:
        '200':
          description: Contenido del documento exportado.
          content:
            text/plain:
              schema:
                type: string
